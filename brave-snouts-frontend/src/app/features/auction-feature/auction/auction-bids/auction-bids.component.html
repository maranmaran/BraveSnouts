<div class="container" fxLayout="column" fxLayoutGap="1rem" *ngIf="(auction$ | async) as auction">

    <div id="auction-details" [ngClass]="{'mt-4': mediaObs.isActive('lt-sm')}" fxLayout="column" fxLayoutGap="1rem">

        <div fxLayout="row">
            <div class="section" fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="1rem" fxFlex="100%"
                fxFlex.lt-md="100%">
                <div class="mat-title mb-0 bold">{{ auction.name }}</div>
                <div fxLayout="row" fxLayoutGap="1rem" class="foreground"
                    [ngClass]="{'warn default': state == 'expired', 'primary lighter': state == 'future'}">

                    <div [ngSwitch]="state">
                        <ng-container *ngSwitchCase="'future'">
                            Počinje: {{ auction.startDate.toDate() | date: 'MMM d, HH:mm:ss' }}
                        </ng-container>
                        <ng-container *ngSwitchCase="'expired'">
                            Završila: {{ auction.endDate.toDate() | date: 'MMM d, HH:mm:ss' }}
                        </ng-container>

                        <ng-container *ngSwitchCase="'active'">
                            Traje do: {{ auction.endDate.toDate() | date: 'MMM d, HH:mm:ss' }}
                        </ng-container>
                    </div>
                    <countdown *ngIf="state == 'active' && config" class="m-0 bold" #cd [config]="config">
                    </countdown>
                </div>
            </div>
        </div>

    </div>

    <div id="admin-actions" fxLayout="row wrap" class="section">
        <button [disabled]="!(state == 'expired' && !auction.processed)" mat-flat-button color="warn" (click)="closeAuction(auction.id)">Zatvori aukciju</button>
    </div>

    <div id="items-list" fxLayout="row" fxLayoutGap="1rem" class="w-100 pb-3 overflow-x">

        <div *ngFor="let item of (items$ | async)">

            <mat-card id="winner" *ngIf="winners.get(item.id) as winner" class="elevate hover selected mb-3" [ngClass]="{'selected': activeItemId == winner.itemId}">
                <mat-card-header>
                    <mat-card-title fxLayout="row" fxLayoutAlign="start center"> 
                        <mat-icon class="mr-2" style="color: #f9d935">emoji_events</mat-icon> {{ winner.userInfo.name }}
                    </mat-card-title>
                    <mat-card-subtitle>{{ winner.userInfo.email }}</mat-card-subtitle>
                </mat-card-header>
                
                <mat-card-content fxLayout="column" fxLayoutGap="0.5rem">

                    <div id="delivery" class="mat-small" fxLayout="row" fxLayoutGap="0.5rem">
                        <label class="pb-0 bold center">Odabir dostave:</label> 
                        <ng-container [ngSwitch]="winner.deliveryChoice">
                            <label *ngSwitchCase="'handover'" class=" foreground primary lighter"> Osobno </label>
                            <label *ngSwitchCase="'postal'" style="color: #c326ff"> 
                                Poštom
                                <button mat-icon-button 
                                *ngIf="winner.deliveryChoice == 'postal' && winner.postalInformation" 
                                (click)="openPostalInformation(winner.postalInformation)" 
                                matTooltip="Detalji za slanje">
                                    <mat-icon>drafts</mat-icon>
                                </button>     
                            </label>
                            <label *ngSwitchDefault class="foreground primary lighter"> Nije odabrano </label>
                        </ng-container>
                    </div>

                    <div id="payment" class="mat-small pb-0" fxLayout="row" fxLayoutGap="0.5rem">

                        <label class="pb-0 bold center">Status plaćanja:</label>
                        <mat-button-toggle-group [value]="winner.paymentStatus">
                            <mat-button-toggle value="paid" class="foreground primary lighter">Plaćeno</mat-button-toggle>
                            <mat-button-toggle value="pending">U toku</mat-button-toggle>
                            <mat-button-toggle value="notpaid" class="foreground warn default">Nije plaćeno</mat-button-toggle>
                          </mat-button-toggle-group>
                    </div>


                </mat-card-content>

                <mat-card-actions>
                    <!-- <button mat-stroked-button color="primary" (click)="getBids(item.id)">Pokaži najbolje ponude</button> -->
                </mat-card-actions>
            </mat-card>

            <mat-card id="item" class="elevate hover selected" [ngClass]="{'selected': activeItemId == item.id}">
                <mat-card-header>
                    <mat-card-title>{{ item.name }}</mat-card-title>
                </mat-card-header>
                <mat-card-actions>
                    <button mat-stroked-button color="primary" (click)="getBids(item.id)">Pokaži najbolje
                        ponude</button>
                </mat-card-actions>
            </mat-card>

        </div>

    </div>

    <ng-container *ngIf="!!(bids$ | async)">

        <ng-container *ngIf="(bids$ | async)?.length > 0 ;else noBids">
            <mat-card *ngFor="let bid of (bids$ | async)" class="elevate hover">
                <mat-card-header>
                    <img mat-card-avatar [src]="bid.userInfo?.avatar">
                    <mat-card-title>
                        {{ bid.userInfo?.name }} - {{ bid.bid }} kn
                    </mat-card-title>
                    <mat-card-subtitle>
                        {{ bid.date.toDate() | date: 'MMM d, h:mm:ss' }}
                    </mat-card-subtitle>
                    <mat-card-subtitle>
                        {{ bid.userInfo?.email }}
                    </mat-card-subtitle>
                </mat-card-header>
            </mat-card>
        </ng-container>
        
        <ng-template #noBids>
            <i>Nažalost nema ponuda :( </i>
        </ng-template>
    </ng-container>

</div>